FROM public.ecr.aws/amazonlinux/amazonlinux:2023

ARG VERSION=1.0.0
WORKDIR /app

COPY green_${VERSION} /app/green
RUN chmod +x /app/green

RUN yum update -y && yum install -y curl && yum clean all

EXPOSE 8080
HEALTHCHECK --interval=30s --timeout=5s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8080/health || exit 1

ENTRYPOINT ["./green"]
CMD ["-p", "8080"]